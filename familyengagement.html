<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nurturing Number Sense: Family Math Night</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F7FFF7; /* Off-white background */
            color: #1A535C; /* Dark Teal Text */
        }

        /* Chart Container Styling - Mandatory Requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Constraint for large screens */
            margin-left: auto;
            margin-right: auto;
            height: 300px; /* Base height */
            max-height: 400px;
            background: #ffffff;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Palette Classes */
        .bg-coral { background-color: #FF6B6B; }
        .bg-turquoise { background-color: #4ECDC4; }
        .bg-yellow { background-color: #FFE66D; }
        .bg-dark-teal { background-color: #1A535C; }
        
        .text-coral { color: #FF6B6B; }
        .text-turquoise { color: #4ECDC4; }
        .text-yellow { color: #F5D300; /* Slightly darker for text legibility */ }
        .text-dark-teal { color: #1A535C; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #4ECDC4;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #1A535C;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Hero Section -->
    <header class="bg-dark-teal text-white pt-12 pb-24 relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
            <!-- Decorative Background Pattern using CSS Gradients (No SVG) -->
            <div style="background-image: radial-gradient(#FFE66D 20%, transparent 20%), radial-gradient(#FF6B6B 20%, transparent 20%); background-position: 0 0, 50px 50px; background-size: 100px 100px; width: 100%; height: 100%;"></div>
        </div>
        
        <div class="container mx-auto px-4 text-center relative z-10">
            <span class="inline-block bg-yellow text-dark-teal px-4 py-1 rounded-full text-sm font-bold mb-4 uppercase tracking-wider">Family Math Night</span>
            <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight">Nurturing Number Sense<br><span class="text-turquoise">Through Play & Routine</span></h1>
            <p class="text-xl max-w-2xl mx-auto text-gray-200">
                Play and daily routines nurture a childâ€™s natural desire to describe the math all around them. Discover why it matters and how to start.
            </p>
        </div>
    </header>

    <!-- Main Content Grid -->
    <main class="container mx-auto px-4 -mt-16 relative z-20 pb-20">
        
        <!-- Section 1: The Why (Line Chart) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
            <div class="bg-white rounded-xl shadow-lg p-8 md:col-span-2">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h2 class="text-3xl font-bold text-coral mb-4">Why Early Math Matters?</h2>
                        <p class="text-gray-600 mb-4">
                            Research indicates that early mathematical proficiency is a strong predictor of later academic success. Children who are exposed to number sense activities in Pre-K demonstrate a steeper learning trajectory throughout elementary school.
                        </p>
                        <ul class="space-y-2 mb-6">
                            <li class="flex items-center"><span class="text-2xl mr-2">ðŸ“ˆ</span> Higher confidence in problem solving.</li>
                            <li class="flex items-center"><span class="text-2xl mr-2">ðŸ§ </span> Improved logical reasoning skills.</li>
                            <li class="flex items-center"><span class="text-2xl mr-2">ðŸš€</span> Readiness for STEM concepts.</li>
                        </ul>
                    </div>
                    <div class="w-full">
                        <div class="chart-container">
                            <canvas id="impactChart"></canvas>
                        </div>
                        <p class="text-xs text-center text-gray-400 mt-2">Data based on landmark early childhood studies (e.g., NIEER) showing high-exposure correlation to 3rd Grade achievement.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: The Gap (Pie/Donut) & Section 3: The Components (Radar) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
            
            <!-- Card: The Home Routine Gap -->
            <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col">
                <h3 class="text-2xl font-bold text-dark-teal mb-2">The Home Routine Gap</h3>
                <p class="text-gray-600 mb-6 text-sm">
                    While families often read bedtime stories, math is frequently left out of daily rituals. Integrating just 5-10 minutes of "Math Talk" can bridge this gap.
                </p>
                <div class="chart-container flex-grow">
                    <canvas id="gapChart"></canvas>
                </div>
                <div class="mt-4 text-center">
                    <p class="text-coral font-bold text-lg">Target: Balance the Equation!</p>
                </div>
            </div>

            <!-- Card: Components of Number Sense -->
            <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col">
                <h3 class="text-2xl font-bold text-dark-teal mb-2">What is Number Sense?</h3>
                <p class="text-gray-600 mb-6 text-sm">
                    It is more than just counting. Number sense involves understanding relationships, patterns, and quantities.
                </p>
                <div class="chart-container flex-grow">
                    <canvas id="skillsRadar"></canvas>
                </div>
                <div class="mt-4 text-center">
                    <p class="text-turquoise font-bold text-lg">A Holistic Approach</p>
                </div>
            </div>
        </div>

        <!-- Section 4: Developmental Trajectory (Plotly) -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-16">
            <div class="mb-6 text-center">
                <h2 class="text-3xl font-bold text-coral mb-2">Curiosity Milestones</h2>
                <p class="text-gray-600 max-w-2xl mx-auto">
                    Children develop mathematical curiosity in stages. Understanding where your child fits on this trajectory helps in selecting the right play activities.
                </p>
            </div>
            <!-- Plotly Container -->
            <div id="plotlyContainer" class="w-full h-96 bg-gray-50 rounded-lg border border-gray-100 relative">
                <!-- Plotly chart injects here -->
            </div>
            <p class="text-xs text-center text-gray-400 mt-2">Data illustrates typical developmental progression of number concepts.</p>
        </div>

        <!-- Section 5: Embedding Math (Process Flow / Cards) -->
        <div class="mb-16">
            <h2 class="text-3xl font-bold text-dark-teal mb-8 text-center">Math in Daily Routines</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Routine 1 -->
                <div class="bg-yellow rounded-lg p-1 shadow-md transform transition hover:-translate-y-1">
                    <div class="bg-white h-full p-6 rounded-lg flex flex-col items-center text-center">
                        <div class="text-4xl mb-4">ðŸ¥£</div>
                        <h4 class="font-bold text-xl mb-2">Mealtime Math</h4>
                        <p class="text-gray-600 text-sm">
                            "How many plates do we need?" "Let's cut the sandwich into 4 triangles." "Which cup has more juice?"
                        </p>
                    </div>
                </div>

                <!-- Routine 2 -->
                <div class="bg-turquoise rounded-lg p-1 shadow-md transform transition hover:-translate-y-1">
                    <div class="bg-white h-full p-6 rounded-lg flex flex-col items-center text-center">
                        <div class="text-4xl mb-4">ðŸ§¸</div>
                        <h4 class="font-bold text-xl mb-2">Cleanup Countdown</h4>
                        <p class="text-gray-600 text-sm">
                            "Let's count backward from 10 while we pick up toys!" "Sort the blocks by color." "Put the big bears in the big bin."
                        </p>
                    </div>
                </div>

                <!-- Routine 3 -->
                <div class="bg-coral rounded-lg p-1 shadow-md transform transition hover:-translate-y-1">
                    <div class="bg-white h-full p-6 rounded-lg flex flex-col items-center text-center">
                        <div class="text-4xl mb-4">ðŸ›’</div>
                        <h4 class="font-bold text-xl mb-2">On The Go</h4>
                        <p class="text-gray-600 text-sm">
                            "Can you find the number 5 on a sign?" "Let's count the red cars." "Are we turning left or right?"
                        </p>
                    </div>
                </div>

            </div>
        </div>

        <!-- Section 6: Gemini LLM Routine Generator -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-16 border-t-4 border-turquoise">
            <h2 class="text-3xl font-bold text-dark-teal mb-4 flex items-center">
                Routine Idea Generator âœ¨
            </h2>
            <p class="text-gray-600 mb-6">
                Need fresh ideas? Tell our expert math assistant a daily household routine, and it will generate specific, play-based number sense activities you can try today!
            </p>
            
            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                <input type="text" id="routineInput" placeholder="Example: Unloading the dishwasher" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-turquoise focus:border-turquoise text-dark-teal">
                <button id="generateButton" class="bg-coral text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-red-500 transition duration-300 flex items-center justify-center disabled:opacity-50">
                    Generate Math Ideas âœ¨
                </button>
            </div>

            <div id="resultsContainer" class="mt-8">
                <!-- Results will be displayed here -->
                <div id="loadingIndicator" class="hidden text-center text-dark-teal">
                    <div class="flex items-center justify-center space-x-2">
                        <div class="w-4 h-4 rounded-full bg-turquoise animate-pulse"></div>
                        <div class="w-4 h-4 rounded-full bg-coral animate-pulse"></div>
                        <div class="w-4 h-4 rounded-full bg-yellow animate-pulse"></div>
                        <span>Thinking up fun activities...</span>
                    </div>
                </div>
                <div id="routineOutput" class="p-4 bg-gray-50 border border-gray-200 rounded-lg text-gray-700 whitespace-pre-wrap min-h-[100px]">
                    Your generated math routines will appear here! Try "Making the Bed" or "Setting the Table."
                </div>
            </div>
        </div>

        <!-- Call to Action / Event Details -->
        <div class="bg-dark-teal text-white rounded-2xl p-8 md:p-12 text-center shadow-2xl relative overflow-hidden">
             <!-- Decorative Circle -->
            <div class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 bg-turquoise rounded-full opacity-20"></div>
            <div class="absolute bottom-0 left-0 -ml-16 -mb-16 w-48 h-48 bg-coral rounded-full opacity-20"></div>

            <h2 class="text-3xl md:text-5xl font-bold mb-6 relative z-10">Join Us & Learn More!</h2>
            <p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto relative z-10">
                Leave this session with play-based activities and ideas to embed number sense into your daily routines, cultivating your child's mathematical curiosity!
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-3xl mx-auto text-left bg-white/10 p-6 rounded-xl backdrop-blur-sm relative z-10">
                <div>
                    <p class="text-turquoise text-sm font-bold uppercase tracking-wide">Presenter</p>
                    <p class="font-bold text-lg">Nicole Jawhari</p>
                    <p class="text-sm opacity-80">RPDP (Regional Professional Development Program)</p>
                </div>
                <div>
                    <p class="text-turquoise text-sm font-bold uppercase tracking-wide">When</p>
                    <p class="font-bold text-lg">Wednesday, January 14, 2026</p>
                    <p class="text-sm opacity-80">2:00 PM â€“ 3:00 PM</p>
                </div>
                <div class="md:col-span-2 border-t border-white/20 pt-4 mt-2">
                     <p class="text-turquoise text-sm font-bold uppercase tracking-wide">Who Should Attend</p>
                     <p class="font-bold">Pre-K and Kindergarten Families</p>
                </div>
            </div>

            <button class="mt-8 bg-coral hover:bg-red-500 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 relative z-10">
                RSVP Now
            </button>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-400 py-6 text-center text-sm">
        <p>Â© 2026 RPDP Family Engagement. All rights reserved.</p>
        <p class="mt-2">Created for Pre-K & Kindergarten Families.</p>
    </footer>

    <!-- Script Section -->
    <script>
        // Palette Colors
        const coral = '#FF6B6B';
        const turquoise = '#4ECDC4';
        const yellow = '#FFE66D';
        const darkTeal = '#1A535C';
        const lightGray = '#f3f4f6';

        // --- Chart.js Configuration & Helpers ---

        // Helper: Label Wrapping Logic (Mandatory > 16 chars split)
        function wrapLabel(label) {
            if (typeof label !== 'string') return label;
            if (label.length <= 16) return label;
            
            const words = label.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if ((currentLine + " " + words[i]).length > 16) {
                    lines.push(currentLine);
                    currentLine = words[i];
                } else {
                    currentLine += " " + words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // Helper: Process array of labels
        function processLabels(labels) {
            return labels.map(l => wrapLabel(l));
        }

        // Mandatory Tooltip Configuration
        const commonTooltipConfig = {
            callbacks: {
                title: function(tooltipItems) {
                    const item = tooltipItems[0];
                    let label = item.chart.data.labels[item.dataIndex];
                    if (Array.isArray(label)) {
                        return label.join(' ');
                    } else {
                        return label;
                    }
                }
            }
        };

        // --- Chart 1: Impact Chart (Line) ---
        const ctxImpact = document.getElementById('impactChart').getContext('2d');
        const labelsImpact = processLabels(['Preschool', 'Kindergarten', '1st Grade', '2nd Grade', '3rd Grade']);
        
        new Chart(ctxImpact, {
            type: 'line',
            data: {
                labels: labelsImpact,
                datasets: [
                    {
                        label: 'With Math Routines',
                        data: [50, 70, 85, 95, 98],
                        borderColor: coral,
                        backgroundColor: coral,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 5,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: coral,
                        fill: false
                    },
                    {
                        label: 'Standard Exposure',
                        data: [30, 45, 60, 70, 75],
                        borderColor: darkTeal,
                        backgroundColor: darkTeal,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 5,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: darkTeal,
                        fill: false,
                        borderDash: [5, 5]
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: commonTooltipConfig,
                    title: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: { display: true, text: 'Concept Mastery Score' }
                    }
                }
            }
        });

        // --- Chart 2: The Gap (Doughnut) ---
        const ctxGap = document.getElementById('gapChart').getContext('2d');
        const labelsGap = processLabels(['Reading at Home', 'Math at Home']);

        new Chart(ctxGap, {
            type: 'doughnut',
            data: {
                labels: labelsGap,
                datasets: [{
                    data: [85, 15], // Typical disparity statistics
                    backgroundColor: [turquoise, yellow],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: commonTooltipConfig
                },
                cutout: '70%'
            }
        });

        // --- Chart 3: Skills Radar (Radar) ---
        const ctxRadar = document.getElementById('skillsRadar').getContext('2d');
        const labelsRadar = processLabels([
            'Counting & Cardinality', 
            'Spatial Relationships', 
            'Patterns & Sorting', 
            'Measurement', 
            'Operations'
        ]);

        new Chart(ctxRadar, {
            type: 'radar',
            data: {
                labels: labelsRadar,
                datasets: [{
                    label: 'Target Proficiency',
                    data: [90, 85, 80, 70, 75],
                    fill: true,
                    backgroundColor: 'rgba(255, 107, 107, 0.2)', // Coral transparent
                    borderColor: coral,
                    pointBackgroundColor: coral,
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: coral
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: commonTooltipConfig
                },
                scales: {
                    r: {
                        angleLines: { color: '#e5e7eb' },
                        grid: { color: '#e5e7eb' },
                        pointLabels: {
                            font: { size: 10, family: 'Poppins' },
                            color: darkTeal
                        },
                        suggestedMin: 0,
                        suggestedMax: 100
                    }
                }
            }
        });

        // --- Chart 4: Developmental Trajectory (Plotly.js) ---
        // Using Canvas rendering via 'scattergl' or config if possible, but basic scatter usually svg/canvas hybrid.
        // We will configure it to look clean and match the palette.
        
        const plotlyData = [
            {
                x: [3, 4, 5, 6], // Age
                y: [2, 5, 12, 25], // Vocabulary count related to math (simulated)
                mode: 'markers+lines',
                type: 'scatter',
                name: 'Math Vocabulary Words',
                line: { color: turquoise, width: 3 },
                marker: { size: 12, color: turquoise }
            },
            {
                x: [3, 4, 5, 6],
                y: [1, 3, 7, 15],
                mode: 'markers+lines',
                type: 'scatter',
                name: 'Complex Patterns',
                line: { color: yellow, width: 3, dash: 'dot' },
                marker: { size: 12, color: yellow }
            }
        ];

        const plotlyLayout = {
            margin: { t: 20, r: 20, b: 40, l: 40 },
            showlegend: true,
            legend: { orientation: 'h', y: -0.2 },
            xaxis: { 
                title: 'Child Age (Years)', 
                gridcolor: '#f3f4f6',
                zerolinecolor: '#f3f4f6'
            },
            yaxis: { 
                title: 'Concepts Mastered',
                gridcolor: '#f3f4f6',
                zerolinecolor: '#f3f4f6'
            },
            font: { family: 'Poppins', color: darkTeal },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)'
        };

        const plotlyConfig = {
            responsive: true,
            displayModeBar: false,
            // Force WebGL/Canvas where applicable for performance, though scatter is standard
            renderer: 'canvas' 
        };

        Plotly.newPlot('plotlyContainer', plotlyData, plotlyLayout, plotlyConfig);

        // --- LLM Integration: Routine Generator ---

        const generateButton = document.getElementById('generateButton');
        const routineInput = document.getElementById('routineInput');
        const routineOutput = document.getElementById('routineOutput');
        const loadingIndicator = document.getElementById('loadingIndicator');

        const MAX_RETRIES = 5;
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        async function fetchWithExponentialBackoff(fetcher, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    return await fetcher();
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        async function generateRoutineIdeas() {
            const routine = routineInput.value.trim();
            if (!routine) {
                routineOutput.innerHTML = '<p class="text-coral">Please enter a daily routine first (e.g., "Washing hands").</p>';
                return;
            }

            generateButton.disabled = true;
            loadingIndicator.classList.remove('hidden');
            routineOutput.textContent = ''; 

            const systemPrompt = "You are an expert early childhood mathematics educator specializing in Pre-K and Kindergarten development. Your task is to generate 3 simple, play-based activities that embed number sense concepts (like counting, sorting, patterns, measurement, or cardinality) into the given daily routine. Format the response as a numbered list with bold titles for each activity. Use clear, parent-friendly language and focus on minimal materials.";
            
            const userQuery = `Generate 3 math activities for the routine: ${routine}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            const fetcher = async () => {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            };

            try {
                const result = await fetchWithExponentialBackoff(fetcher, MAX_RETRIES);
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't generate ideas right now. Please try again.";
                
                // Simple Markdown to HTML conversion for bold text and numbered list formatting from LLM response
                let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                formattedText = formattedText.replace(/\n\s*(\d+\.)/g, '<br>$1');

                routineOutput.innerHTML = formattedText;

            } catch (error) {
                routineOutput.innerHTML = `<p class="text-red-600">Error generating ideas. Please check your network connection or try again later.</p>`;
            } finally {
                generateButton.disabled = false;
                loadingIndicator.classList.add('hidden');
            }
        }

        generateButton.addEventListener('click', generateRoutineIdeas);

    </script>
</body>
</html>